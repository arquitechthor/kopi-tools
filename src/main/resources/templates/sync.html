<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/layout :: head}"></head>

<body>

    <nav th:replace="~{fragments/layout :: navbar}"></nav>

    <div class="container">
        <h2 class="mb-4">Synchronization Settings</h2>

        <div th:if="${success}" class="alert alert-success" role="alert" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>

        <div class="card">
            <div class="card-header">
                AWS S3 Backup
            </div>
            <div class="card-body">
                <p class="card-text">
                    This feature allows you to backup your database to AWS S3.
                    <br>
                    <strong>Status:</strong>
                    <span th:if="${isConfigured}" class="badge bg-success">Configured</span>
                    <span th:unless="${isConfigured}" class="badge bg-warning text-dark">Not Configured</span>
                </p>

                <div th:if="${isConfigured}">
                    <p><strong>Bucket:</strong> <span th:text="${bucketName}"></span></p>
                    <form method="post" th:action="@{/settings/sync/upload}" class="d-inline">
                        <button type="submit" class="btn btn-primary"
                            onclick="return confirm('Do you want to upload a backup? This will overwrite the file in S3.');">
                            <i class="fas fa-cloud-upload-alt"></i> Synchronize Now
                        </button>
                    </form>

                    <form method="post" th:action="@{/settings/sync/restore}" class="d-inline ms-2">
                        <button type="submit" class="btn btn-warning"
                            onclick="return confirm('Do you want to restore from S3? This will overwrite your local data.');">
                            <i class="fas fa-cloud-download-alt"></i> Restore Backup
                        </button>
                    </form>
                </div>

                <div th:unless="${isConfigured}">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> No AWS credentials found.
                        <p class="mt-2 text-danger small">
                            <strong>Note:</strong> AWS credentials must NOT be stored in the repository.
                        </p>
                        <p class="mb-0">
                            To enable synchronization, please configure the following environment variables on your
                            system:
                        </p>
                        <ul>
                            <li><code>AWS_ACCESS_KEY_ID</code></li>
                            <li><code>AWS_SECRET_ACCESS_KEY</code></li>
                            <li><code>AWS_REGION</code> (e.g., eu-west-1)</li>
                            <li><code>S3_BUCKET_NAME</code></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer th:replace="~{fragments/layout :: footer}"></footer>

</body>

</html>